# TimeTrack Electron Release Runbook (macOS + Windows + GitHub Releases)

## 1. Scope and Preconditions

1. Target repo: `Minkyu01/TimeTrack`
2. Node.js 20.x + npm installed
3. Dependencies installed (`npm install`)
4. GitHub Actions enabled on target repository
5. Packaging toolchain available (`electron-builder`)

## 2. Required Secrets and Signing Inputs

### 2.1 GitHub publish

1. GitHub Actions uses `GITHUB_TOKEN` for release upload (`contents: write`)
2. Local publish uses `GH_TOKEN` with `repo` scope

### 2.2 macOS signing and notarization (recommended for trusted install/update)

1. `CSC_LINK`: base64 or file link for Developer ID Application certificate (`.p12`)
2. `CSC_KEY_PASSWORD`: certificate password
3. `APPLE_ID`: Apple account for notarization
4. `APPLE_APP_SPECIFIC_PASSWORD`: app-specific password
5. `APPLE_TEAM_ID`: Apple Developer Team ID

If these are missing, build can still complete unsigned, but Gatekeeper trust and updater reliability can degrade.

### 2.3 Windows signing (recommended)

1. `WIN_CSC_LINK` (or shared `CSC_LINK`)
2. `WIN_CSC_KEY_PASSWORD` (or shared `CSC_KEY_PASSWORD`)

Unsigned installer distribution is possible for internal testing, but SmartScreen trust will be lower.

## 3. Auto Update Trust Requirements

1. Auto update is enabled only for packaged macOS/Windows app builds.
2. Development/non-packaged or unsupported runtime must remain safely disabled.
3. Published release must include updater metadata and blockmap files generated by `electron-builder`.
4. App version must increase with semver; do not reuse a previously published version tag.
5. Release host remains GitHub Releases (`owner: Minkyu01`, `repo: TimeTrack`) for feed consistency.

## 4. Release Versioning and Channel Rules

1. Stable channel tag format: `vMAJOR.MINOR.PATCH` (example: `v1.0.1`)
2. Do not overwrite or delete published binaries for an existing stable tag
3. If release is faulty, publish a new patch version (example: `v1.0.2`)
4. Pre-release channels are not currently configured in updater policy

## 5. Build and Publish Commands

1. Local smoke package:
   - `npm run dist:dir`
2. Local macOS artifacts:
   - `npm run dist:mac`
3. Local Windows artifacts:
   - `npm run dist:win`
4. Publish macOS:
   - `npm run release:mac`
5. Publish Windows:
   - `npm run release:win`
6. CI release workflow:
   - `.github/workflows/release.yml`
   - trigger by pushing tag `v*`

## 6. Artifact and Integrity Rules

1. Output root: `dist-electron/`
2. macOS expected artifacts:
   - `TimeTrack-<version>-arm64.dmg`
   - `TimeTrack-<version>-arm64-mac.zip`
   - related `*.blockmap`
3. Windows expected artifacts:
   - `TimeTrack Setup <version>.exe` (NSIS)
   - `TimeTrack-<version>-win.zip`
   - related updater metadata
4. Checksum rule:
   - Generate `SHA256SUMS.txt` per release build
   - Example (macOS/Linux shell):
     - `shasum -a 256 dist-electron/* > dist-electron/SHA256SUMS.txt`
   - Example (PowerShell):
     - `Get-FileHash dist-electron\* -Algorithm SHA256 | Format-Table -AutoSize`
5. Keep checksum output with release evidence (artifact bundle or release notes attachment)

## 7. Pre-release Checklist (Mandatory)

1. Regression:
   - `npm run test:e2e` green
2. Desktop update code syntax check:
   - `node --check electron/main.js`
   - `node --check electron/preload.js`
   - `node --check public/app.js`
3. Packaging smoke:
   - `npm run dist:dir`
4. Manual smoke:
   - Launch packaged app
   - PIN verify and write flow
   - Student CRUD
   - Lesson CRUD and drag move
   - Backup and restore
   - Manual update check button (`업데이트 확인`)
5. Release gating:
   - Version bump confirmed
   - Semver tag prepared
   - Required secrets present in CI

## 8. Failure Recovery and Rollback

1. CI release upload failed:
   - Re-run failed workflow job
   - If needed, publish from local with `release:*` command and valid token
2. Released version defect:
   - Publish next patch version
   - Do not replace existing tag assets
3. Updater failure in production:
   - Verify release metadata and blockmap presence
   - Verify signing state and platform trust policy
   - Verify monotonically increasing semver
4. Emergency rollback policy:
   - Freeze current rollout communication
   - Publish fixed patch as highest version
   - Record incident and mitigation in implementation artifact log

## 9. Rehearsal Evidence

1. Latest dry-run record:
   - `_bmad-output/implementation-artifacts/12-4-release-rehearsal-2026-02-21.md`
